<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>YES</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"
    integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o" crossorigin="anonymous"></script>

  <link href='https://fonts.googleapis.com/css?family=IM+Fell+English+SC' rel='stylesheet' type='text/css'>
  <audio id="order" type="audio/mpeg"
    loop
    oncanplay="audioLoad()"
    preload="none">
    <source src="order.mp3">
  </audio>

  <style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background-color: black;

    color: #ff8866;
    font-size: 2.4em;
    font-family: 'IM Fell English SC', serif;
  }

  div#main-container {
    background-repeat: no-repeat;
    background-size: cover;
    background-color: black;

    visibility: hidden;
    opacity: 0;
    transition: visibility 0s, opacity 2.5s ease-out;
    -webkit-transition: visibility 0s, opacity 2.5s ease-out;
  }

  div#main-container .row .text-container {
    z-index: 2;
  }

  div#fx-container {
    z-index: 1;
  }

  canvas#fx-canvas {
    box-sizing: border-box;
    -webkit-box-sizing: border-box;
  }

  button#order-bringer {
    z-index: 3;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

    /* border-radius: 50%; */
    border: transparent;
    background: transparent;
    color: #ff8866;
    
    animation: pulse 1.5s infinite;
    -webkit-animation: pulse 0.3s infinite;
  }

  @keyframes pulse {
    0% {
      transform: translate(-50%, -50%) scale(.98);
    }
    30% {
      transform: translate(-50%, -50%) scale(1);
    }
      100% {
      transform: translate(-50%, -50%) scale(.98);
    }
  }

  @-webkit-keyframes pulse {
    0% {
      transform: translate(-50%, -50%) scale(.98);
    }
    30% {
      transform: translate(-50%, -50%) scale(1);
    }
      100% {
      transform: translate(-50%, -50%) scale(.98);
    }
  }
  </style>
  <script>
  let button;
  let audio, context, source, analyser, bufferLength, dataArray;
  let canvas, canvasContext;

  const colorValue = function (f, transparency) {
    const mask = (0xff << ( ( (f % 3) + 1 ) * 8 ));
    return '#' + ((((f<<24) + (f<<16) + (f<<8)) & mask) + transparency).toString(16);
  }

  const canvasLoop = function () {
    requestAnimationFrame(canvasLoop);
    canvasContext.clearRect(0, 0, canvas.width, canvas.height);
    
    analyser.getByteFrequencyData(dataArray);
    for (let i=0; i < bufferLength; i++)
    {
      const f = dataArray[i];
      canvasContext.fillStyle = colorValue(f, 10);
      const ratio = f.toFixed() / 256;
      canvasContext.fillRect(canvas.width * ratio, canvas.height * ratio, canvas.width * ratio, canvas.height * ratio);
    }
  }

  const audioLoad = function () {
    source = context.createMediaElementSource(audio);
    analyser = context.createAnalyser();
    source.connect(analyser);
    analyser.connect(context.destination);
    analyser.fftSize = 512;

    bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);

    audio.volume = 0.1;
    audio.play();
    canvasLoop();
  }

  const loadImage = function () {
    button.style.display = 'none';
    const image = new Image();
    image.onload = imageLoaded;
    image.src = "order.jpg";
  };

  const imageLoaded = function () {
    context.resume();
    audio.load();
    const container = document.getElementById("main-container");
    container.style.opacity = 1;
    container.style.visibility = 'visible';
    container.style.backgroundImage = 'url("order.jpg")';
  };

  $(document).ready(function () {
    canvas = document.getElementById("fx-canvas");
    canvasContext = canvas.getContext("2d");
    audio = document.getElementById("order");
    button = document.getElementById("order-bringer");
  });

  $(window).on('load', function () {
    context = new (window.AudioContext || window.webkitAudioContext)({sampleRate: 44100});
  });
  </script>
</head>
<body>
  <button id="order-bringer" class="" onclick="loadImage()">YES</button>
  <div id="main-container" class="container-fluid h-100 p-0 m-0 d-flex flex-row align-items-center">
    <div class="row w-100 p-0 m-0 justify-content-center">
      <div id="fx-container" class="w-100 h-100 p-0 m-0 fixed-top">
        <canvas id="fx-canvas" class="w-100 h-100"></canvas>
      </div>
      <div class="text-container col-12 col-lg-10 p-0 m-0">
        <h1 class="text-center m-0 p-0">YES, I SEE THE ORDER NOW</h1>
      </div>
    </div>
  </div>
</body>
</html>